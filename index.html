<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Athlete Profile</title>

<style>
:root{
  --black:#000;
  --white:#fff;
  --grey:#f4f4f4;
  --muted:#8a8a8a;
  --line:#e5e5e5;
  --radius:28px;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background:var(--white);
  color:var(--black);
  -webkit-font-smoothing:antialiased;
}

.top{
  padding:18px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid var(--line);
}

.role{
  font-size:12px;
  font-weight:800;
  letter-spacing:1px;
  text-transform:uppercase;
}

.club{
  font-size:12px;
  color:var(--muted);
  font-weight:600;
}

.page{
  max-width:1200px;
  margin:auto;
  padding:40px 24px 80px;
}

.hero{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  flex-wrap:wrap;
  gap:24px;
  margin-bottom:40px;
}

.name{
  font-size:64px;
  font-weight:900;
  letter-spacing:-3px;
  line-height:0.9;
}

.subline{
  margin-top:16px;
  font-size:14px;
  font-weight:600;
  color:var(--muted);
}

.teamTag{
  font-size:14px;
  font-weight:800;
  letter-spacing:1px;
  text-transform:uppercase;
}

.layout{
  display:grid;
  grid-template-columns:1.2fr 0.8fr;
  gap:28px;
}

@media(max-width:1000px){
  .layout{grid-template-columns:1fr}
  .name{font-size:44px}
}

.card{
  border-radius:var(--radius);
  padding:28px;
  border:1px solid var(--line);
}

.performance{
  background:var(--black);
  color:var(--white);
}

.performance h3{
  margin:0;
  font-size:14px;
  font-weight:800;
  letter-spacing:1px;
  text-transform:uppercase;
  opacity:0.6;
}

.performance .value{
  margin-top:16px;
  font-size:42px;
  font-weight:900;
  letter-spacing:-2px;
}

.grid2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;
  margin-top:24px;
}

.stat{
  border-radius:20px;
  padding:20px;
  background:var(--grey);
}

.statLabel{
  font-size:12px;
  font-weight:700;
  color:var(--muted);
}

.statValue{
  margin-top:10px;
  font-size:22px;
  font-weight:900;
  letter-spacing:-1px;
}

.avatarWrap{
  position:relative;
  width:120px;
  height:120px;
  border-radius:30px;
  overflow:hidden;
}

.avatar{
  width:100%;
  height:100%;
  object-fit:cover;
  background:#ddd;
}

.actions{
  margin-top:28px;
  display:flex;
  gap:14px;
  flex-wrap:wrap;
}

button{
  border:none;
  border-radius:999px;
  padding:14px 20px;
  font-weight:800;
  letter-spacing:0.5px;
  cursor:pointer;
  transition:all .15s ease;
}

.primary{
  background:var(--black);
  color:var(--white);
}

.secondary{
  background:var(--grey);
}

button:hover{transform:translateY(-2px)}

select{
  margin-top:20px;
  padding:14px;
  border-radius:999px;
  border:1px solid var(--line);
  font-weight:800;
  width:100%;
  max-width:350px;
}

.sectionTitle{
  font-size:12px;
  font-weight:800;
  text-transform:uppercase;
  letter-spacing:1px;
  margin-bottom:14px;
}

.alertBox{
  background:var(--grey);
  border-radius:24px;
  padding:24px;
  margin-top:20px;
}

.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:var(--black);
  color:#fff;
  padding:10px 18px;
  border-radius:999px;
  display:none;
}
</style>
</head>

<body>

<div class="top">
  <div>
    <div class="role" id="roleText">—</div>
    <div class="club" id="clubText">—</div>
  </div>
  <div id="today"></div>
</div>

<div class="page">

  <div class="hero">
    <div>
      <div class="name" id="athleteName">LOADING</div>
      <div class="subline" id="playerId"></div>
    </div>
    <div class="teamTag" id="teamName"></div>
  </div>

  <div class="layout">

    <div>
      <div class="card performance">
        <h3>Next Event</h3>
        <div class="value" id="eventType">—</div>
        <div id="eventDetails" style="margin-top:10px;font-weight:600;"></div>
      </div>

      <div class="grid2">
        <div class="stat">
          <div class="statLabel">Jersey</div>
          <div class="statValue" id="jersey">—</div>
        </div>
        <div class="stat">
          <div class="statLabel">DOB</div>
          <div class="statValue" id="dob">—</div>
        </div>
      </div>

      <div class="alertBox">
        <div class="sectionTitle">Alert</div>
        <div id="alertTitle"></div>
        <div id="alertMsg" style="margin-top:8px;font-weight:600;"></div>
      </div>
    </div>

    <div>
      <div class="avatarWrap">
        <img id="avatar" class="avatar"/>
      </div>

      <div class="actions">
        <button class="primary" id="viewIdpBtn">View IDP</button>
        <button class="secondary" id="changePhotoBtn">Change Photo</button>
        <button class="primary" id="savePhotoBtn" style="display:none;">Save Photo</button>
      </div>

      <select id="kidSelect" style="display:none;"></select>
    </div>

  </div>
</div>

<div class="toast" id="toast"></div>

<script>
let state=null;
let pendingDataUrl=null;

function post(type,payload={}){
  window.parent.postMessage({type,payload},"*");
}

function toast(msg){
  const t=document.getElementById("toast");
  t.innerText=msg;
  t.style.display="block";
  setTimeout(()=>t.style.display="none",2000);
}

function render(){
  if(!state)return;
  const p=state.player||{};
  document.getElementById("athleteName").innerText=
    (p.firstName||"")+" "+(p.lastName||"");
  document.getElementById("playerId").innerText=
    p.id?`Player ID: ${p.id}`:"";
  document.getElementById("roleText").innerText=state.role||"";
  document.getElementById("clubText").innerText=state.clubSlug||"";
  document.getElementById("today").innerText=state.today||"";
  document.getElementById("teamName").innerText=state.team?.name||"";
  document.getElementById("jersey").innerText=p.jerseyNumber?`#${p.jerseyNumber}`:"—";
  document.getElementById("dob").innerText=p.dob||"—";
  document.getElementById("avatar").src=p.photoUrl||"";

  const evt=state.nextEvent;
  if(!evt){
    document.getElementById("eventType").innerText="No Upcoming Event";
    document.getElementById("eventDetails").innerText="";
  }else{
    document.getElementById("eventType").innerText=evt.type||"";
    document.getElementById("eventDetails").innerText=
      `${evt.opponent? "vs "+evt.opponent:""} ${evt.date||""} ${evt.time||""}`;
  }

  document.getElementById("alertTitle").innerText=state.alert?.title||"No alerts";
  document.getElementById("alertMsg").innerText=state.alert?.message||"";

  const kids=state.kids||[];
  const sel=document.getElementById("kidSelect");
  if(state.role==="Parent"&&kids.length){
    sel.style.display="block";
    sel.innerHTML=kids.map(k=>
      `<option value="${k.id}" ${k.id===state.activePlayerId?"selected":""}>${k.name}</option>`
    ).join("");
  }
}

window.addEventListener("message",(event)=>{
  const msg=event.data||{};
  if(msg.type==="STATE"){
    state=msg.payload;
    render();
  }
  if(msg.type==="TOAST")toast(msg.payload?.message||"");
});

document.getElementById("viewIdpBtn")
  .addEventListener("click",()=>post("VIEW_IDP",{}));

document.getElementById("kidSelect")
  .addEventListener("change",(e)=>
    post("SELECT_KID",{playerId:e.target.value})
  );

window.addEventListener("load",()=>{
  post("IFRAME_READY",{});
  setTimeout(()=>post("IFRAME_READY",{}),800);
});
</script>
</body>
</html>
